{"version":3,"sources":["../../server/controllers/usercontroller.js"],"names":["UserPriviledge","req","res","foundBookId","foundUserId","body","dateBorrowed","dateToReturn","bookId","parseInt","params","userId","found","bookQty","bookShelf","userDb","filter","item","id","length","booksDb","i","brwdBooksDb","returnStatus","quantity","newbrwId","newBrwdBook","push","brwId","brwApproval","rtnApproval","status","send","message","borrowId","console","log","returnApproval"],"mappings":"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","file":"usercontroller.js","sourcesContent":["import books from '../models/booksDb';\r\nimport user from '../models/userDb';\r\nimport brwdBooks from '../models/brwdBooksDb';\r\n\r\n/**\r\n  * @class UserPriviledge\r\n  */\r\n   export default class UserPriviledge {\r\n   /**\r\n  *\r\n  * @param {object} req \r\n  * @param {object} res\r\n  * @return {object} json object\r\n  */\r\n  \r\n\r\n  borrowBook(req,res){\r\n  let foundBookId = false;\r\n  let foundUserId = false;\r\n  const {dateBorrowed, dateToReturn } = req.body;\r\n  const bookId = parseInt(req.params.bookId, 10);\r\n  const userId = parseInt(req.params.userId, 10);\r\n  let found = false;\r\n  let bookQty = 0;\r\n  let bookShelf = 0;\r\n  if(user.userDb.filter(item => item.id === parseInt(userId,10)).length === 1){ \r\n    if(books.booksDb.filter(item => item.bookId === parseInt(bookId, 10)).length === 1) {\r\n        for (let i = 0; i < brwdBooks.brwdBooksDb.length; i++) {\r\n            if ((brwdBooks.brwdBooksDb[i].bookId === bookId) && (brwdBooks.brwdBooksDb[i].userId === userId) ) {\r\n               if( !(brwdBooks.brwdBooksDb[i].returnStatus === 'Approved') ) {\r\n                   found = true;\r\n                   break;\r\n                }\r\n            }  \r\n        }\r\n        for (let i = 0; i < books.booksDb.length; i++) {\r\n            if ((books.booksDb[i].bookId === bookId) ) {\r\n                bookQty = books.booksDb[i].quantity;\r\n                bookShelf = i;\r\n                break;\r\n            }  \r\n        }\r\n        if ((found === false) ) {\r\n            if ((bookQty >= 1)) {\r\n                const newbrwId = brwdBooks.brwdBooksDb.length + 1;\r\n                const newBrwdBook = brwdBooks.brwdBooksDb.push({\r\n                    brwId: newbrwId,\r\n                    bookId,\r\n                    userId,\r\n                    dateBorrowed,\r\n                    dateToReturn,\r\n                    brwApproval: \"ApprovaL Request made, waiting for Admin Approval\",\r\n                    rtnApproval: \"yet to be returned\",\r\n                    returnStatus: \"yet to be returned\"\r\n        \r\n                });\r\n                // books.booksDb[bookShelf].quantity -= 1;\r\n                res.status(200).send({\r\n                    newBrwdBook: brwdBooks.brwdBooksDb,\r\n                    message: 'Success'\r\n                 });\r\n            } else {\r\n                res.status(401).send({\r\n                    message: 'Sorry we ran out of stock for this book!'\r\n                });\r\n            }\r\n             \r\n        } else {\r\n            res.status(401).send({\r\n                message: 'Sorry you must first return borrowed book before making another request'\r\n            });\r\n        }\r\n    } else {\r\n        res.status(404).send({\r\n           message: ' No book of such exists!'\r\n        });\r\n    }\r\n  } else {\r\n    res.status(403).send({\r\n        message: 'you are not authorised to borrow a book, kindly register to gain priviledge!'\r\n    }); \r\n  }\r\n\r\n }\r\n\r\n returnBook(req,res) {\r\n    let found = false;\r\n    const bookId = parseInt(req.params.bookId, 10);\r\n    const userId = parseInt(req.params.userId, 10);\r\n    let borrowId = 0;\r\n    let returnStatus = '';\r\n    for (let i = 0; i < brwdBooks.brwdBooksDb.length; i++) {\r\n        if ((brwdBooks.brwdBooksDb[i].bookId === bookId) && (brwdBooks.brwdBooksDb[i].userId === userId) ) {\r\n            found = true;\r\n            borrowId = i;\r\n            returnStatus = brwdBooks.brwdBooksDb[i].returnStatus;\r\n            break;\r\n        }  \r\n    }\r\n\r\n    if (found === true) {\r\n        if (returnStatus !== 'Approved') {\r\n            console.log(returnStatus);\r\n            brwdBooks.brwdBooksDb.rtnApproval = \"Approval request made, waiting for administrator approval\";\r\n            brwdBooks.brwdBooksDb.returnStatus = \"pending\";\r\n                res.status(201).send({\r\n                    returnApproval: brwdBooks.brwdBooksDb.rtnApproval,\r\n                    returnStatus:  brwdBooks.brwdBooksDb.returnStatus\r\n                });\r\n        } else {\r\n            res.status(409).send({\r\n                message: 'Sorry! this book seems to have been returned'\r\n            });\r\n        }  \r\n    } else {\r\n        res.status(404).send({\r\n            message: 'Sorry We can\\'t find your record'\r\n        });\r\n    }\r\n }\r\n}"]}